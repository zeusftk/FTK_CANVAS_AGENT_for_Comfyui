var $t=e=>{throw TypeError(e)};var ot=(e,t,r)=>t.has(e)||$t("Cannot "+r);var F=(e,t,r)=>(ot(e,t,"read from private field"),r?r.call(e):t.get(e)),_e=(e,t,r)=>t.has(e)?$t("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Se=(e,t,r,n)=>(ot(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Re=(e,t,r)=>(ot(e,t,"access private method"),r);import{c as Fe,ag as ln,ah as fn,ai as Lt,aj as dn,ak as fr,al as hn,r as l,am as pn,an as mn,ao as dr,g as vn,ae as D,ap as Bt,j as s,d as yn,Z as bn,P as kt,b as gn,u as hr,e as Ut,f as xn,h as wn,i as pr,aq as _n,L as mr,l as vr,o as fe,ar as yt,S as Sn,as as Rn,B as En,v as Me,at as Be,G as Ie,K as at,au as Cn,af as jn}from"./index-DNT9Vl18.js";import{D as yr,a as br,b as gr,c as On,d as zn,e as Nn,f as Pn}from"./TopMenu-CGgZSjXt.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],An=Fe("arrow-up",kn);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],In=Fe("hash",Mn);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Dn=Fe("loader-circle",Tn);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["rect",{width:"12",height:"20",x:"6",y:"2",rx:"2",key:"1oxtiu"}]],Wt=Fe("rectangle-vertical",Fn);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ht=Fe("square",$n);var de,he,Y,se,ce,Ue,bt,lr,Ln=(lr=class extends ln{constructor(r,n){super();_e(this,ce);_e(this,de);_e(this,he);_e(this,Y);_e(this,se);Se(this,de,r),this.setOptions(n),this.bindMethods(),Re(this,ce,Ue).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var o;const n=this.options;this.options=F(this,de).defaultMutationOptions(r),fn(this.options,n)||F(this,de).getMutationCache().notify({type:"observerOptionsUpdated",mutation:F(this,Y),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&Lt(n.mutationKey)!==Lt(this.options.mutationKey)?this.reset():((o=F(this,Y))==null?void 0:o.state.status)==="pending"&&F(this,Y).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=F(this,Y))==null||r.removeObserver(this)}onMutationUpdate(r){Re(this,ce,Ue).call(this),Re(this,ce,bt).call(this,r)}getCurrentResult(){return F(this,he)}reset(){var r;(r=F(this,Y))==null||r.removeObserver(this),Se(this,Y,void 0),Re(this,ce,Ue).call(this),Re(this,ce,bt).call(this)}mutate(r,n){var o;return Se(this,se,n),(o=F(this,Y))==null||o.removeObserver(this),Se(this,Y,F(this,de).getMutationCache().build(F(this,de),this.options)),F(this,Y).addObserver(this),F(this,Y).execute(r)}},de=new WeakMap,he=new WeakMap,Y=new WeakMap,se=new WeakMap,ce=new WeakSet,Ue=function(){var n;const r=((n=F(this,Y))==null?void 0:n.state)??dn();Se(this,he,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},bt=function(r){fr.batch(()=>{var n,o,a,i,c,u,h,b;if(F(this,se)&&this.hasListeners()){const d=F(this,he).variables,p=F(this,he).context;(r==null?void 0:r.type)==="success"?((o=(n=F(this,se)).onSuccess)==null||o.call(n,r.data,d,p),(i=(a=F(this,se)).onSettled)==null||i.call(a,r.data,null,d,p)):(r==null?void 0:r.type)==="error"&&((u=(c=F(this,se)).onError)==null||u.call(c,r.error,d,p),(b=(h=F(this,se)).onSettled)==null||b.call(h,void 0,r.error,d,p))}this.listeners.forEach(d=>{d(F(this,he))})})},lr);function Bn(e,t){const r=hn(),[n]=l.useState(()=>new Ln(r,e));l.useEffect(()=>{n.setOptions(e)},[n,e]);const o=l.useSyncExternalStore(l.useCallback(i=>n.subscribe(fr.batchCalls(i)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),a=l.useCallback((i,c)=>{n.mutate(i,c).catch(pn)},[n]);if(o.error&&mn(n.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:a,mutateAsync:o.mutate}}async function La(){try{const e=await fetch("/api/canvas/list");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return Array.isArray(t)?t:(console.error("Expected array but got:",typeof t,t),[])}catch(e){return console.error("Error fetching canvases:",e),[]}}async function Ba(e){return await(await fetch("/api/canvas/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async function Ua(e){return await(await fetch(`/api/canvas/${e}`)).json()}async function Wa(e,t){return await(await fetch(`/api/canvas/${e}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async function Ha(e,t){return await(await fetch(`/api/canvas/${e}/rename`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})})).json()}async function Va(e){return await(await fetch(`/api/canvas/${e}/delete`,{method:"DELETE"})).json()}const qa=async e=>await(await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e.newMessages,canvas_id:e.canvasId,session_id:e.sessionId,text_model:e.textModel,tool_list:e.toolList,system_prompt:e.systemPrompt})})).json(),Un=async e=>await(await fetch(`/api/cancel/${e}`,{method:"POST"})).json(),Ka=async e=>await(await fetch("/api/magic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e.newMessages,canvas_id:e.canvasId,session_id:e.sessionId,system_prompt:e.systemPrompt})})).json(),Wn=async e=>await(await fetch(`/api/magic/cancel/${e}`,{method:"POST"})).json();function Hn(e){return new Promise((t,r)=>{const n=document.createElement("canvas"),o=n.getContext("2d"),a=new Image,i=e.size/1024;console.log(`🦄 Canvas compressLargeImage imagesize: ${e.name} (${Math.round(i)}KB)`),a.onload=()=>{try{let{width:h,height:b}=a;const d=32048;if(h>d||b>d){const x=Math.min(d/h,d/b);h=Math.round(h*x),b=Math.round(b*x)}n.width=h,n.height=b,o==null||o.drawImage(a,0,0,h,b);let p=1,m,_=0;do{if(m=n.toDataURL("image/jpeg",p),Math.round(m.length*.75)<=2048*1024||_>=5){t(m);return}p*=.8,_++}while(_<5);t(m)}catch{r(new Error(`Failed to compress image: ${e.name}`))}},a.onerror=()=>r(new Error(`Failed to load image: ${e.name}`));const c=URL.createObjectURL(e),u=a.onload;a.onload=function(h){return URL.revokeObjectURL(c),u==null?void 0:u.call(this,h)},a.src=c})}async function Vn(e){const t=e.size/1024;if(console.log(`🦄 upload compressImageFile imagesize: ${e.name} (${Math.round(t)}KB)`),t<=32048)return e;console.log(`Compressing large image: ${e.name} (${Math.round(t)}KB)`);try{const r=await Hn(e),n=dr(r,e.name);return console.log(`Image compressed: ${e.name} (${Math.round(t)}KB → ${Math.round(n.size/1024)}KB)`),n}catch(r){return console.warn(`Failed to compress image ${e.name}, using original:`,r),e}}async function qn(e){console.log("upload image...",e);const t=await Vn(e),r=new FormData;return r.append("file",t),await(await fetch("/api/upload_file",{method:"POST",body:r})).json()}function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ee.apply(null,arguments)}function Z(e){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(e)}function Kn(e,t){if(Z(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Z(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xr(e){var t=Kn(e,"string");return Z(t)=="symbol"?t:t+""}function re(e,t,r){return(t=xr(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Vt(Object(r),!0).forEach(function(n){re(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gt(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Gn(e){if(Array.isArray(e))return gt(e)}function Yn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wr(e,t){if(e){if(typeof e=="string")return gt(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gt(e,t):void 0}}function Jn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xn(e){return Gn(e)||Yn(e)||wr(e)||Jn()}function Qn(e){if(Array.isArray(e))return e}function Zn(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,a,i,c=[],u=!0,h=!1;try{if(a=(r=r.call(e)).next,t!==0)for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(b){h=!0,o=b}finally{try{if(!u&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(h)throw o}}return c}}function eo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(e,t){return Qn(e)||Zn(e,t)||wr(e,t)||eo()}function to(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function At(e,t){if(e==null)return{};var r,n,o=to(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var it={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var qt;function ro(){return qt||(qt=1,function(e){(function(){var t={}.hasOwnProperty;function r(){for(var a="",i=0;i<arguments.length;i++){var c=arguments[i];c&&(a=o(a,n(c)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return r.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var i="";for(var c in a)t.call(a,c)&&a[c]&&(i=o(i,c));return i}function o(a,i){return i?a?a+" "+i:a+i:a}e.exports?(r.default=r,e.exports=r):window.classNames=r})()}(it)),it.exports}var no=ro();const Q=vn(no);function oo(e){return!!(e.addonBefore||e.addonAfter)}function ao(e){return!!(e.prefix||e.suffix||e.allowClear)}function Kt(e,t,r){var n=t.cloneNode(!0),o=Object.create(e,{target:{value:n},currentTarget:{value:n}});return n.value=r,typeof t.selectionStart=="number"&&typeof t.selectionEnd=="number"&&(n.selectionStart=t.selectionStart,n.selectionEnd=t.selectionEnd),n.setSelectionRange=function(){t.setSelectionRange.apply(t,arguments)},o}function Gt(e,t,r,n){if(r){var o=t;if(t.type==="click"){o=Kt(t,e,""),r(o);return}if(e.type!=="file"&&n!==void 0){o=Kt(t,e,n),r(o);return}r(o)}}var io=D.forwardRef(function(e,t){var r,n,o,a=e.inputElement,i=e.children,c=e.prefixCls,u=e.prefix,h=e.suffix,b=e.addonBefore,d=e.addonAfter,p=e.className,m=e.style,_=e.disabled,x=e.readOnly,f=e.focused,E=e.triggerFocus,S=e.allowClear,A=e.value,I=e.handleReset,N=e.hidden,j=e.classes,R=e.classNames,U=e.dataAttrs,L=e.styles,O=e.components,B=e.onClear,y=i??a,g=(O==null?void 0:O.affixWrapper)||"span",w=(O==null?void 0:O.groupWrapper)||"span",W=(O==null?void 0:O.wrapper)||"span",M=(O==null?void 0:O.groupAddon)||"span",J=l.useRef(null),v=function(ye){var K;(K=J.current)!==null&&K!==void 0&&K.contains(ye.target)&&(E==null||E())},C=ao(e),T=l.cloneElement(y,{value:A,className:Q((r=y.props)===null||r===void 0?void 0:r.className,!C&&(R==null?void 0:R.variant))||null}),G=l.useRef(null);if(D.useImperativeHandle(t,function(){return{nativeElement:G.current||J.current}}),C){var k=null;if(S){var $=!_&&!x&&A,H="".concat(c,"-clear-icon"),ue=Z(S)==="object"&&S!==null&&S!==void 0&&S.clearIcon?S.clearIcon:"✖";k=D.createElement("button",{type:"button",tabIndex:-1,onClick:function(ye){I==null||I(ye),B==null||B()},onMouseDown:function(ye){return ye.preventDefault()},className:Q(H,re(re({},"".concat(H,"-hidden"),!$),"".concat(H,"-has-suffix"),!!h))},ue)}var ne="".concat(c,"-affix-wrapper"),ze=Q(ne,re(re(re(re(re({},"".concat(c,"-disabled"),_),"".concat(ne,"-disabled"),_),"".concat(ne,"-focused"),f),"".concat(ne,"-readonly"),x),"".concat(ne,"-input-with-clear-btn"),h&&S&&A),j==null?void 0:j.affixWrapper,R==null?void 0:R.affixWrapper,R==null?void 0:R.variant),Ne=(h||S)&&D.createElement("span",{className:Q("".concat(c,"-suffix"),R==null?void 0:R.suffix),style:L==null?void 0:L.suffix},k,h);T=D.createElement(g,Ee({className:ze,style:L==null?void 0:L.affixWrapper,onClick:v},U==null?void 0:U.affixWrapper,{ref:J}),u&&D.createElement("span",{className:Q("".concat(c,"-prefix"),R==null?void 0:R.prefix),style:L==null?void 0:L.prefix},u),T,Ne)}if(oo(e)){var ve="".concat(c,"-group"),oe="".concat(ve,"-addon"),Pe="".concat(ve,"-wrapper"),tt=Q("".concat(c,"-wrapper"),ve,j==null?void 0:j.wrapper,R==null?void 0:R.wrapper),$e=Q(Pe,re({},"".concat(Pe,"-disabled"),_),j==null?void 0:j.group,R==null?void 0:R.groupWrapper);T=D.createElement(w,{className:$e,ref:G},D.createElement(W,{className:tt},b&&D.createElement(M,{className:oe},b),T,d&&D.createElement(M,{className:oe},d)))}return D.cloneElement(T,{className:Q((n=T.props)===null||n===void 0?void 0:n.className,p)||null,style:q(q({},(o=T.props)===null||o===void 0?void 0:o.style),m),hidden:N})});function Yt(e){var t=l.useRef();t.current=e;var r=l.useCallback(function(){for(var n,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=t.current)===null||n===void 0?void 0:n.call.apply(n,[t].concat(a))},[]);return r}function so(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Jt=so()?l.useLayoutEffect:l.useEffect,xt=function(t,r){var n=l.useRef(!0);Jt(function(){return t(n.current)},r),Jt(function(){return n.current=!1,function(){n.current=!0}},[])},Xt=function(t,r){xt(function(n){if(!n)return t()},r)};function Qt(e){var t=l.useRef(!1),r=l.useState(e),n=ie(r,2),o=n[0],a=n[1];l.useEffect(function(){return t.current=!1,function(){t.current=!0}},[]);function i(c,u){u&&t.current||a(c)}return[o,i]}function st(e){return e!==void 0}function _r(e,t){var r=t||{},n=r.defaultValue,o=r.value,a=r.onChange,i=r.postState,c=Qt(function(){return st(o)?o:st(n)?typeof n=="function"?n():n:typeof e=="function"?e():e}),u=ie(c,2),h=u[0],b=u[1],d=o!==void 0?o:h,p=i?i(d):d,m=Yt(a),_=Qt([d]),x=ie(_,2),f=x[0],E=x[1];Xt(function(){var A=f[0];h!==A&&m(h,A)},[f]),Xt(function(){st(o)||b(o)},[o]);var S=Yt(function(A,I){b(A,I),E([d],I)});return[p,S]}var co=["show"];function uo(e,t){return l.useMemo(function(){var r={};t&&(r.show=Z(t)==="object"&&t.formatter?t.formatter:!!t),r=q(q({},r),e);var n=r,o=n.show,a=At(n,co);return q(q({},a),{},{show:!!o,showFormatter:typeof o=="function"?o:void 0,strategy:a.strategy||function(i){return i.length}})},[e,t])}var lo=Symbol.for("react.element"),fo=Symbol.for("react.transitional.element"),ho=Symbol.for("react.fragment");function Sr(e){return e&&Z(e)==="object"&&(e.$$typeof===lo||e.$$typeof===fo)&&e.type===ho}function wt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=[];return D.Children.forEach(e,function(n){n==null&&!t.keepEmpty||(Array.isArray(n)?r=r.concat(wt(n)):Sr(n)&&n.props?r=r.concat(wt(n.props.children,t)):r.push(n))}),r}function Zt(e){return e instanceof HTMLElement||e instanceof SVGElement}function po(e){return e&&Z(e)==="object"&&Zt(e.nativeElement)?e.nativeElement:Zt(e)?e:null}function ct(e){var t=po(e);if(t)return t;if(e instanceof D.Component){var r;return(r=Bt.findDOMNode)===null||r===void 0?void 0:r.call(Bt,e)}return null}var ut={exports:{}},z={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var er;function mo(){if(er)return z;er=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),i=Symbol.for("react.context"),c=Symbol.for("react.server_context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),_;_=Symbol.for("react.module.reference");function x(f){if(typeof f=="object"&&f!==null){var E=f.$$typeof;switch(E){case e:switch(f=f.type,f){case r:case o:case n:case h:case b:return f;default:switch(f=f&&f.$$typeof,f){case c:case i:case u:case p:case d:case a:return f;default:return E}}case t:return E}}}return z.ContextConsumer=i,z.ContextProvider=a,z.Element=e,z.ForwardRef=u,z.Fragment=r,z.Lazy=p,z.Memo=d,z.Portal=t,z.Profiler=o,z.StrictMode=n,z.Suspense=h,z.SuspenseList=b,z.isAsyncMode=function(){return!1},z.isConcurrentMode=function(){return!1},z.isContextConsumer=function(f){return x(f)===i},z.isContextProvider=function(f){return x(f)===a},z.isElement=function(f){return typeof f=="object"&&f!==null&&f.$$typeof===e},z.isForwardRef=function(f){return x(f)===u},z.isFragment=function(f){return x(f)===r},z.isLazy=function(f){return x(f)===p},z.isMemo=function(f){return x(f)===d},z.isPortal=function(f){return x(f)===t},z.isProfiler=function(f){return x(f)===o},z.isStrictMode=function(f){return x(f)===n},z.isSuspense=function(f){return x(f)===h},z.isSuspenseList=function(f){return x(f)===b},z.isValidElementType=function(f){return typeof f=="string"||typeof f=="function"||f===r||f===o||f===n||f===h||f===b||f===m||typeof f=="object"&&f!==null&&(f.$$typeof===p||f.$$typeof===d||f.$$typeof===a||f.$$typeof===i||f.$$typeof===u||f.$$typeof===_||f.getModuleId!==void 0)},z.typeOf=x,z}var tr;function vo(){return tr||(tr=1,ut.exports=mo()),ut.exports}var lt=vo();function yo(e,t,r){var n=l.useRef({});return(!("value"in n.current)||r(n.current.condition,t))&&(n.current.value=e(),n.current.condition=t),n.current.value}var bo=Number(l.version.split(".")[0]),go=function(t,r){typeof t=="function"?t(r):Z(t)==="object"&&t&&"current"in t&&(t.current=r)},xo=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r.filter(Boolean);return o.length<=1?o[0]:function(a){r.forEach(function(i){go(i,a)})}},wo=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return yo(function(){return xo.apply(void 0,r)},r,function(o,a){return o.length!==a.length||o.every(function(i,c){return i!==a[c]})})},_o=function(t){var r,n;if(!t)return!1;if(Rr(t)&&bo>=19)return!0;var o=lt.isMemo(t)?t.type.type:t.type;return!(typeof o=="function"&&!((r=o.prototype)!==null&&r!==void 0&&r.render)&&o.$$typeof!==lt.ForwardRef||typeof t=="function"&&!((n=t.prototype)!==null&&n!==void 0&&n.render)&&t.$$typeof!==lt.ForwardRef)};function Rr(e){return l.isValidElement(e)&&!Sr(e)}var So=function(t){if(t&&Rr(t)){var r=t;return r.props.propertyIsEnumerable("ref")?r.props.ref:r.ref}return null},_t=l.createContext(null);function Ro(e){var t=e.children,r=e.onBatchResize,n=l.useRef(0),o=l.useRef([]),a=l.useContext(_t),i=l.useCallback(function(c,u,h){n.current+=1;var b=n.current;o.current.push({size:c,element:u,data:h}),Promise.resolve().then(function(){b===n.current&&(r==null||r(o.current),o.current=[])}),a==null||a(c,u,h)},[r,a]);return l.createElement(_t.Provider,{value:i},t)}var Er=function(){if(typeof Map<"u")return Map;function e(t,r){var n=-1;return t.some(function(o,a){return o[0]===r?(n=a,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var n=e(this.__entries__,r),o=this.__entries__[n];return o&&o[1]},t.prototype.set=function(r,n){var o=e(this.__entries__,r);~o?this.__entries__[o][1]=n:this.__entries__.push([r,n])},t.prototype.delete=function(r){var n=this.__entries__,o=e(n,r);~o&&n.splice(o,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var o=0,a=this.__entries__;o<a.length;o++){var i=a[o];r.call(n,i[1],i[0])}},t}()}(),St=typeof window<"u"&&typeof document<"u"&&window.document===document,We=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Eo=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(We):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),Co=2;function jo(e,t){var r=!1,n=!1,o=0;function a(){r&&(r=!1,e()),n&&c()}function i(){Eo(a)}function c(){var u=Date.now();if(r){if(u-o<Co)return;n=!0}else r=!0,n=!1,setTimeout(i,t);o=u}return c}var Oo=20,zo=["top","right","bottom","left","width","height","size","weight"],No=typeof MutationObserver<"u",Po=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=jo(this.refresh.bind(this),Oo)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var r=this.observers_,n=r.indexOf(t);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return t.forEach(function(r){return r.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!St||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),No?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!St||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var r=t.propertyName,n=r===void 0?"":r,o=zo.some(function(a){return!!~n.indexOf(a)});o&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),Cr=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];Object.defineProperty(e,o,{value:t[o],enumerable:!1,writable:!1,configurable:!0})}return e},Ce=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||We},jr=Ye(0,0,0,0);function He(e){return parseFloat(e)||0}function rr(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce(function(n,o){var a=e["border-"+o+"-width"];return n+He(a)},0)}function ko(e){for(var t=["top","right","bottom","left"],r={},n=0,o=t;n<o.length;n++){var a=o[n],i=e["padding-"+a];r[a]=He(i)}return r}function Ao(e){var t=e.getBBox();return Ye(0,0,t.width,t.height)}function Mo(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return jr;var n=Ce(e).getComputedStyle(e),o=ko(n),a=o.left+o.right,i=o.top+o.bottom,c=He(n.width),u=He(n.height);if(n.boxSizing==="border-box"&&(Math.round(c+a)!==t&&(c-=rr(n,"left","right")+a),Math.round(u+i)!==r&&(u-=rr(n,"top","bottom")+i)),!To(e)){var h=Math.round(c+a)-t,b=Math.round(u+i)-r;Math.abs(h)!==1&&(c-=h),Math.abs(b)!==1&&(u-=b)}return Ye(o.left,o.top,c,u)}var Io=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof Ce(e).SVGGraphicsElement}:function(e){return e instanceof Ce(e).SVGElement&&typeof e.getBBox=="function"}}();function To(e){return e===Ce(e).document.documentElement}function Do(e){return St?Io(e)?Ao(e):Mo(e):jr}function Fo(e){var t=e.x,r=e.y,n=e.width,o=e.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,i=Object.create(a.prototype);return Cr(i,{x:t,y:r,width:n,height:o,top:r,right:t+n,bottom:o+r,left:t}),i}function Ye(e,t,r,n){return{x:e,y:t,width:r,height:n}}var $o=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Ye(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=Do(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),Lo=function(){function e(t,r){var n=Fo(r);Cr(this,{target:t,contentRect:n})}return e}(),Bo=function(){function e(t,r,n){if(this.activeObservations_=[],this.observations_=new Er,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Ce(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)||(r.set(t,new $o(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Ce(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(t)&&(r.delete(t),r.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&t.activeObservations_.push(r)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new Lo(n.target,n.broadcastRect())});this.callback_.call(t,r,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),Or=typeof WeakMap<"u"?new WeakMap:new Er,zr=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=Po.getInstance(),n=new Bo(t,r,this);Or.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){zr.prototype[e]=function(){var t;return(t=Or.get(this))[e].apply(t,arguments)}});var Uo=function(){return typeof We.ResizeObserver<"u"?We.ResizeObserver:zr}(),pe=new Map;function Wo(e){e.forEach(function(t){var r,n=t.target;(r=pe.get(n))===null||r===void 0||r.forEach(function(o){return o(n)})})}var Nr=new Uo(Wo);function Ho(e,t){pe.has(e)||(pe.set(e,new Set),Nr.observe(e)),pe.get(e).add(t)}function Vo(e,t){pe.has(e)&&(pe.get(e).delete(t),pe.get(e).size||(Nr.unobserve(e),pe.delete(e)))}function qo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ko(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xr(n.key),n)}}function Go(e,t,r){return t&&Ko(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rt(e,t){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Rt(e,t)}function Yo(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rt(e,t)}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ve(e)}function Pr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pr=function(){return!!e})()}function Jo(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xo(e,t){if(t&&(Z(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jo(e)}function Qo(e){var t=Pr();return function(){var r,n=Ve(e);if(t){var o=Ve(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Xo(this,r)}}var Zo=function(e){Yo(r,e);var t=Qo(r);function r(){return qo(this,r),t.apply(this,arguments)}return Go(r,[{key:"render",value:function(){return this.props.children}}]),r}(l.Component);function ea(e,t){var r=e.children,n=e.disabled,o=l.useRef(null),a=l.useRef(null),i=l.useContext(_t),c=typeof r=="function",u=c?r(o):r,h=l.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),b=!c&&l.isValidElement(u)&&_o(u),d=b?So(u):null,p=wo(d,o),m=function(){var E;return ct(o.current)||(o.current&&Z(o.current)==="object"?ct((E=o.current)===null||E===void 0?void 0:E.nativeElement):null)||ct(a.current)};l.useImperativeHandle(t,function(){return m()});var _=l.useRef(e);_.current=e;var x=l.useCallback(function(f){var E=_.current,S=E.onResize,A=E.data,I=f.getBoundingClientRect(),N=I.width,j=I.height,R=f.offsetWidth,U=f.offsetHeight,L=Math.floor(N),O=Math.floor(j);if(h.current.width!==L||h.current.height!==O||h.current.offsetWidth!==R||h.current.offsetHeight!==U){var B={width:L,height:O,offsetWidth:R,offsetHeight:U};h.current=B;var y=R===Math.round(N)?N:R,g=U===Math.round(j)?j:U,w=q(q({},B),{},{offsetWidth:y,offsetHeight:g});i==null||i(w,f,A),S&&Promise.resolve().then(function(){S(w,f)})}},[]);return l.useEffect(function(){var f=m();return f&&!n&&Ho(f,x),function(){return Vo(f,x)}},[o.current,n]),l.createElement(Zo,{ref:a},b?l.cloneElement(u,{ref:p}):u)}var ta=l.forwardRef(ea),ra="rc-observer-key";function na(e,t){var r=e.children,n=typeof r=="function"?[r]:wt(r);return n.map(function(o,a){var i=(o==null?void 0:o.key)||"".concat(ra,"-").concat(a);return l.createElement(ta,Ee({},e,{key:i,ref:a===0?t:void 0}),o)})}var kr=l.forwardRef(na);kr.Collection=Ro;var Ar=function(t){return+setTimeout(t,16)},Mr=function(t){return clearTimeout(t)};typeof window<"u"&&"requestAnimationFrame"in window&&(Ar=function(t){return window.requestAnimationFrame(t)},Mr=function(t){return window.cancelAnimationFrame(t)});var nr=0,Mt=new Map;function Ir(e){Mt.delete(e)}var Et=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;nr+=1;var n=nr;function o(a){if(a===0)Ir(n),t();else{var i=Ar(function(){o(a-1)});Mt.set(n,i)}}return o(r),n};Et.cancel=function(e){var t=Mt.get(e);return Ir(e),Mr(t)};var oa=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,aa=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],ft={},X;function ia(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e.getAttribute("id")||e.getAttribute("data-reactid")||e.getAttribute("name");if(t&&ft[r])return ft[r];var n=window.getComputedStyle(e),o=n.getPropertyValue("box-sizing")||n.getPropertyValue("-moz-box-sizing")||n.getPropertyValue("-webkit-box-sizing"),a=parseFloat(n.getPropertyValue("padding-bottom"))+parseFloat(n.getPropertyValue("padding-top")),i=parseFloat(n.getPropertyValue("border-bottom-width"))+parseFloat(n.getPropertyValue("border-top-width")),c=aa.map(function(h){return"".concat(h,":").concat(n.getPropertyValue(h))}).join(";"),u={sizingStyle:c,paddingSize:a,borderSize:i,boxSizing:o};return t&&r&&(ft[r]=u),u}function sa(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;X||(X=document.createElement("textarea"),X.setAttribute("tab-index","-1"),X.setAttribute("aria-hidden","true"),X.setAttribute("name","hiddenTextarea"),document.body.appendChild(X)),e.getAttribute("wrap")?X.setAttribute("wrap",e.getAttribute("wrap")):X.removeAttribute("wrap");var o=ia(e,t),a=o.paddingSize,i=o.borderSize,c=o.boxSizing,u=o.sizingStyle;X.setAttribute("style","".concat(u,";").concat(oa)),X.value=e.value||e.placeholder||"";var h=void 0,b=void 0,d,p=X.scrollHeight;if(c==="border-box"?p+=i:c==="content-box"&&(p-=a),r!==null||n!==null){X.value=" ";var m=X.scrollHeight-a;r!==null&&(h=m*r,c==="border-box"&&(h=h+a+i),p=Math.max(h,p)),n!==null&&(b=m*n,c==="border-box"&&(b=b+a+i),d=p>b?"":"hidden",p=Math.min(b,p))}var _={height:p,overflowY:d,resize:"none"};return h&&(_.minHeight=h),b&&(_.maxHeight=b),_}var ca=["prefixCls","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],dt=0,ht=1,pt=2,ua=l.forwardRef(function(e,t){var r=e,n=r.prefixCls,o=r.defaultValue,a=r.value,i=r.autoSize,c=r.onResize,u=r.className,h=r.style,b=r.disabled,d=r.onChange;r.onInternalAutoSize;var p=At(r,ca),m=_r(o,{value:a,postState:function(H){return H??""}}),_=ie(m,2),x=_[0],f=_[1],E=function(H){f(H.target.value),d==null||d(H)},S=l.useRef();l.useImperativeHandle(t,function(){return{textArea:S.current}});var A=l.useMemo(function(){return i&&Z(i)==="object"?[i.minRows,i.maxRows]:[]},[i]),I=ie(A,2),N=I[0],j=I[1],R=!!i,U=function(){try{if(document.activeElement===S.current){var H=S.current,ue=H.selectionStart,ne=H.selectionEnd,ze=H.scrollTop;S.current.setSelectionRange(ue,ne),S.current.scrollTop=ze}}catch{}},L=l.useState(pt),O=ie(L,2),B=O[0],y=O[1],g=l.useState(),w=ie(g,2),W=w[0],M=w[1],J=function(){y(dt)};xt(function(){R&&J()},[a,N,j,R]),xt(function(){if(B===dt)y(ht);else if(B===ht){var $=sa(S.current,!1,N,j);y(pt),M($)}else U()},[B]);var v=l.useRef(),C=function(){Et.cancel(v.current)},T=function(H){B===pt&&(c==null||c(H),i&&(C(),v.current=Et(function(){J()})))};l.useEffect(function(){return C},[]);var G=R?W:null,k=q(q({},h),G);return(B===dt||B===ht)&&(k.overflowY="hidden",k.overflowX="hidden"),l.createElement(kr,{onResize:T,disabled:!(i||c)},l.createElement("textarea",Ee({},p,{ref:S,style:k,className:Q(n,u,re({},"".concat(n,"-disabled"),b)),disabled:b,value:x,onChange:E})))}),la=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","onClear","onPressEnter","readOnly","autoSize","onKeyDown"],fa=D.forwardRef(function(e,t){var r,n=e.defaultValue,o=e.value,a=e.onFocus,i=e.onBlur,c=e.onChange,u=e.allowClear,h=e.maxLength,b=e.onCompositionStart,d=e.onCompositionEnd,p=e.suffix,m=e.prefixCls,_=m===void 0?"rc-textarea":m,x=e.showCount,f=e.count,E=e.className,S=e.style,A=e.disabled,I=e.hidden,N=e.classNames,j=e.styles,R=e.onResize,U=e.onClear,L=e.onPressEnter,O=e.readOnly,B=e.autoSize,y=e.onKeyDown,g=At(e,la),w=_r(n,{value:o,defaultValue:n}),W=ie(w,2),M=W[0],J=W[1],v=M==null?"":String(M),C=D.useState(!1),T=ie(C,2),G=T[0],k=T[1],$=D.useRef(!1),H=D.useState(null),ue=ie(H,2),ne=ue[0],ze=ue[1],Ne=l.useRef(null),ve=l.useRef(null),oe=function(){var P;return(P=ve.current)===null||P===void 0?void 0:P.textArea},Pe=function(){oe().focus()};l.useImperativeHandle(t,function(){var V;return{resizableTextArea:ve.current,focus:Pe,blur:function(){oe().blur()},nativeElement:((V=Ne.current)===null||V===void 0?void 0:V.nativeElement)||oe()}}),l.useEffect(function(){k(function(V){return!A&&V})},[A]);var tt=D.useState(null),$e=ie(tt,2),we=$e[0],ye=$e[1];D.useEffect(function(){if(we){var V;(V=oe()).setSelectionRange.apply(V,Xn(we))}},[we]);var K=uo(f,x),ke=(r=K.max)!==null&&r!==void 0?r:h,Qr=Number(ke)>0,rt=K.strategy(v),Zr=!!ke&&rt>ke,Ft=function(P,le){var Le=le;!$.current&&K.exceedFormatter&&K.max&&K.strategy(le)>K.max&&(Le=K.exceedFormatter(le,{max:K.max}),le!==Le&&ye([oe().selectionStart||0,oe().selectionEnd||0])),J(Le),Gt(P.currentTarget,P,c,Le)},en=function(P){$.current=!0,b==null||b(P)},tn=function(P){$.current=!1,Ft(P,P.currentTarget.value),d==null||d(P)},rn=function(P){Ft(P,P.target.value)},nn=function(P){P.key==="Enter"&&L&&L(P),y==null||y(P)},on=function(P){k(!0),a==null||a(P)},an=function(P){k(!1),i==null||i(P)},sn=function(P){J(""),Pe(),Gt(oe(),P,c)},nt=p,Ae;K.show&&(K.showFormatter?Ae=K.showFormatter({value:v,count:rt,maxLength:ke}):Ae="".concat(rt).concat(Qr?" / ".concat(ke):""),nt=D.createElement(D.Fragment,null,nt,D.createElement("span",{className:Q("".concat(_,"-data-count"),N==null?void 0:N.count),style:j==null?void 0:j.count},Ae)));var cn=function(P){var le;R==null||R(P),(le=oe())!==null&&le!==void 0&&le.style.height&&ze(!0)},un=!B&&!x&&!u;return D.createElement(io,{ref:Ne,value:v,allowClear:u,handleReset:sn,suffix:nt,prefixCls:_,classNames:q(q({},N),{},{affixWrapper:Q(N==null?void 0:N.affixWrapper,re(re({},"".concat(_,"-show-count"),x),"".concat(_,"-textarea-allow-clear"),u))}),disabled:A,focused:G,className:Q(E,Zr&&"".concat(_,"-out-of-range")),style:q(q({},S),ne&&!un?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof Ae=="string"?Ae:void 0}},hidden:I,readOnly:O,onClear:U},D.createElement(ua,Ee({},g,{autoSize:B,maxLength:h,onKeyDown:nn,onChange:rn,onFocus:on,onBlur:an,onCompositionStart:en,onCompositionEnd:tn,className:Q(N==null?void 0:N.textarea),style:q(q({},j==null?void 0:j.textarea),{},{resize:S==null?void 0:S.resize}),disabled:A,prefixCls:_,onResize:cn,ref:ve,readOnly:O})))}),Je="Checkbox",[da,Ga]=yn(Je),[ha,It]=da(Je);function pa(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:o,disabled:a,form:i,name:c,onCheckedChange:u,required:h,value:b="on",internal_do_not_use_render:d}=e,[p,m]=gn({prop:r,defaultProp:o??!1,onChange:u,caller:Je}),[_,x]=l.useState(null),[f,E]=l.useState(null),S=l.useRef(!1),A=_?!!i||!!_.closest("form"):!0,I={checked:p,disabled:a,setChecked:m,control:_,setControl:x,name:c,form:i,value:b,hasConsumerStoppedPropagationRef:S,required:h,defaultChecked:me(o)?!1:o,isFormControl:A,bubbleInput:f,setBubbleInput:E};return s.jsx(ha,{scope:t,...I,children:ma(d)?d(I):n})}var Tr="CheckboxTrigger",Dr=l.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},o)=>{const{control:a,value:i,disabled:c,checked:u,required:h,setControl:b,setChecked:d,hasConsumerStoppedPropagationRef:p,isFormControl:m,bubbleInput:_}=It(Tr,e),x=hr(o,b),f=l.useRef(u);return l.useEffect(()=>{const E=a==null?void 0:a.form;if(E){const S=()=>d(f.current);return E.addEventListener("reset",S),()=>E.removeEventListener("reset",S)}},[a,d]),s.jsx(kt.button,{type:"button",role:"checkbox","aria-checked":me(u)?"mixed":u,"aria-required":h,"data-state":Wr(u),"data-disabled":c?"":void 0,disabled:c,value:i,...n,ref:x,onKeyDown:Ut(t,E=>{E.key==="Enter"&&E.preventDefault()}),onClick:Ut(r,E=>{d(S=>me(S)?!0:!S),_&&m&&(p.current=E.isPropagationStopped(),p.current||E.stopPropagation())})})});Dr.displayName=Tr;var Fr=l.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:o,defaultChecked:a,required:i,disabled:c,value:u,onCheckedChange:h,form:b,...d}=e;return s.jsx(pa,{__scopeCheckbox:r,checked:o,defaultChecked:a,disabled:c,required:i,onCheckedChange:h,name:n,form:b,value:u,internal_do_not_use_render:({isFormControl:p})=>s.jsxs(s.Fragment,{children:[s.jsx(Dr,{...d,ref:t,__scopeCheckbox:r}),p&&s.jsx(Ur,{__scopeCheckbox:r})]})})});Fr.displayName=Je;var $r="CheckboxIndicator",Lr=l.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...o}=e,a=It($r,r);return s.jsx(bn,{present:n||me(a.checked)||a.checked===!0,children:s.jsx(kt.span,{"data-state":Wr(a.checked),"data-disabled":a.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});Lr.displayName=$r;var Br="CheckboxBubbleInput",Ur=l.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:o,checked:a,defaultChecked:i,required:c,disabled:u,name:h,value:b,form:d,bubbleInput:p,setBubbleInput:m}=It(Br,e),_=hr(r,m),x=xn(a),f=wn(n);l.useEffect(()=>{const S=p;if(!S)return;const A=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(A,"checked").set,j=!o.current;if(x!==a&&N){const R=new Event("click",{bubbles:j});S.indeterminate=me(a),N.call(S,me(a)?!1:a),S.dispatchEvent(R)}},[p,x,a,o]);const E=l.useRef(me(a)?!1:a);return s.jsx(kt.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??E.current,required:c,disabled:u,name:h,value:b,form:d,...t,tabIndex:-1,ref:_,style:{...t.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ur.displayName=Br;function ma(e){return typeof e=="function"}function me(e){return e==="indeterminate"}function Wr(e){return me(e)?"indeterminate":e?"checked":"unchecked"}function va({className:e,...t}){return s.jsx(Fr,{"data-slot":"checkbox",className:pr("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:s.jsx(Lr,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:s.jsx(_n,{className:"size-3.5"})})})}const ya=({onModelToggle:e,onAutoToggle:t})=>{const{textModel:r,setTextModel:n,textModels:o,selectedTools:a,setSelectedTools:i,allTools:c}=mr(),[u,h]=l.useState("image"),[b,d]=l.useState(!1),{t:p}=vr(),[m,_]=l.useState("auto");l.useEffect(()=>{if(c.length>0){if(m==="auto")i(c),localStorage.setItem("disabled_tool_ids",JSON.stringify([]));else if(m==="external"){const y=c.filter(g=>g.provider!=="FTK_Local");i(y),localStorage.setItem("disabled_tool_ids",JSON.stringify(c.filter(g=>!y.includes(g)).map(g=>g.id)))}}},[m,c,i]);const x=y=>{const g={};return y==null||y.forEach(w=>{g[w.provider]||(g[w.provider]=[]),g[w.provider].push(w)}),g},S=(y=>{const g=Object.entries(y).sort(([w],[W])=>w==="FTK_Local"?-1:W==="FTK_Local"?1:w.localeCompare(W));return Object.fromEntries(g)})((y=>{const g={};return y==null||y.forEach(w=>{g[w.provider]||(g[w.provider]=[]),g[w.provider].push(w)}),g})(o));x(c);const A=y=>{const g=c.filter(w=>w.type===y);return x(g)},I=(y,g)=>{if(u==="llm"){const w=o==null?void 0:o.find(W=>W.provider+":"+W.model===y);w&&(n(w),localStorage.setItem("text_model",y))}else{let w=[];const W=c.find(M=>M.provider+":"+M.id===y);g&&W?w=[...a,W]:w=a.filter(M=>M.provider+":"+M.id!==y),i(w),localStorage.setItem("disabled_tool_ids",JSON.stringify(c.filter(M=>!w.includes(M)).map(M=>M.id))),m!=="manual"&&_("manual")}e==null||e(y,g)},N=y=>{if(u==="llm"){const g=o==null?void 0:o.find(w=>w.provider+":"+w.model===y);g&&(n(g),localStorage.setItem("text_model",y),e==null||e(y,!0))}else if(m==="auto"||m==="external"){_("manual");const g=c.find(w=>w.provider+":"+w.id===y);g&&(i([g]),localStorage.setItem("disabled_tool_ids",JSON.stringify(c.filter(w=>w.id!==g.id).map(w=>w.id))),e==null||e(y,!0))}else{const g=a.some(w=>w.provider+":"+w.id===y);I(y,!g)}},j=y=>{u!=="llm"&&_(y)},R=()=>u==="text"?r?1:0:a.length,U=()=>{if(u==="llm")return S;if(u==="text"){const y=c.filter(g=>g.type==="text");return x(y)}else return A(u)},L=y=>u==="llm"?(r==null?void 0:r.provider)+":"+(r==null?void 0:r.model)===y:a.some(g=>g.provider+":"+g.id===y),O=y=>{const g=Rn[y];return{name:(g==null?void 0:g.name)||y,icon:g==null?void 0:g.icon}},B=[{id:"image",label:p("chat:modelSelector.tabs.image")},{id:"video",label:p("chat:modelSelector.tabs.video")},{id:"text",label:p("chat:modelSelector.tabs.text")},{id:"llm",label:p("chat:modelSelector.tabs.llm")}];return s.jsxs(yr,{open:b,onOpenChange:d,children:[s.jsx(br,{asChild:!0,children:s.jsxs(fe,{size:"sm",variant:"outline",className:`w-fit max-w-[40%] justify-between overflow-hidden ${m!=="manual"?"bg-background border-border text-muted-foreground":"text-primary border-green-200 bg-green-50"}`,children:[m==="auto"?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"}),s.jsx("path",{d:"M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"}),s.jsx("path",{d:"M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"}),s.jsx("path",{d:"M14 7l6 0"}),s.jsx("path",{d:"M17 4l0 6"})]}),s.jsx("span",{className:"ml-2 text-xs whitespace-nowrap",children:p("chat:modelSelector.auto")})]}):m==="external"?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M12 19l7 -7 3 3 -7 7 -3 -3z"}),s.jsx("path",{d:"M18 13l-1.5 -7.5L2 2l3.5 14.5L13 18l5 -5z"}),s.jsx("path",{d:"M2 2l7.586 7.586"}),s.jsx("circle",{cx:"11",cy:"11",r:"2"})]}),s.jsx("span",{className:"ml-2 text-xs whitespace-nowrap",children:p("chat:modelSelector.external")})]}):s.jsxs(s.Fragment,{children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"icon icon-tabler icons-tabler-filled icon-tabler-apps",children:[s.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),s.jsx("path",{d:"M9 3h-4a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2z"}),s.jsx("path",{d:"M9 13h-4a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2z"}),s.jsx("path",{d:"M19 13h-4a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2z"}),s.jsx("path",{d:"M17 3a1 1 0 0 1 .993 .883l.007 .117v2h2a1 1 0 0 1 .117 1.993l-.117 .007h-2v2a1 1 0 0 1 -1.993 .117l-.007 -.117v-2h-2a1 1 0 0 1 -.117 -1.993l.117 -.007h2v-2a1 1 0 0 1 1 -1z"})]}),s.jsxs("span",{className:"ml-2 text-xs whitespace-nowrap",children:[p("chat:modelSelector.manual")," (",R(),")"]})]}),s.jsx(yt,{className:"ml-2 h-4 w-4 opacity-50"})]})}),s.jsxs(gr,{className:"w-96 select-none",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[s.jsx("div",{children:p("chat:modelSelector.title")}),s.jsx("div",{className:"flex items-center gap-2",children:u!=="llm"&&s.jsxs("div",{className:"flex gap-1 bg-muted p-1 rounded-md",children:[s.jsx("button",{className:`px-3 py-1 text-xs rounded ${m==="auto"?"bg-background shadow-sm":"text-muted-foreground"}`,onClick:y=>{y.stopPropagation(),j("auto")},children:p("chat:modelSelector.auto")}),s.jsx("button",{className:`px-3 py-1 text-xs rounded ${m==="external"?"bg-background shadow-sm":"text-muted-foreground"}`,onClick:y=>{y.stopPropagation(),j("external")},children:p("chat:modelSelector.external")}),s.jsx("button",{className:`px-3 py-1 text-xs rounded ${m==="manual"?"bg-background shadow-sm":"text-muted-foreground"}`,onClick:y=>{y.stopPropagation(),j("manual")},children:p("chat:modelSelector.manual")})]})})]}),s.jsx("div",{className:"flex p-1 bg-muted rounded-lg mx-4 my-2",children:B.map(y=>s.jsx("button",{onClick:()=>h(y.id),className:`flex-1 px-3 py-1 rounded-md text-sm font-medium transition-colors cursor-pointer ${u===y.id?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:y.label},y.id))}),s.jsx(Sn,{children:s.jsx("div",{className:"max-h-80 h-80 px-4 pb-4 select-none",children:Object.entries(U()).map(([y,g],w,W)=>{const M=O(y),J=w===W.length-1;return s.jsxs(On,{children:[s.jsx(zn,{className:"text-xs font-medium text-muted-foreground px-0 py-2",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("img",{src:M.icon,alt:M.name,className:"w-4 h-4 rounded-full"}),M.name]})}),g.map(v=>{const C=u==="llm"?`${v.provider}:${v.model||"unknown"}`:`${v.provider}:${v.id||"unknown"}`,T=u==="llm"?v.model||"Unknown Model":v.display_name||v.id||"Unknown Tool";return s.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-muted/50 transition-colors mb-2 cursor-pointer",onClick:()=>N(C),children:[s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"font-medium text-sm",children:T})}),s.jsx(va,{checked:L(C),className:`ml-4 ${(m==="auto"||m==="external")&&u!=="text"?"opacity-50":""}`,disabled:(m==="auto"||m==="external")&&u!=="text"})]},C)}),!J&&s.jsx(Nn,{className:"my-2"})]},y)})})})]})]})};var ba=function(e){return typeof e=="function"},Ya=function(e){return typeof e=="string"},Ja=function(e){return typeof e=="number"};function or(e,t){if(e===t)return!0;for(var r=0;r<e.length;r++)if(!Object.is(e[r],t[r]))return!1;return!0}function Hr(e){var t=l.useRef(e);return t.current=e,t}var ga=function(e){var t=Hr(e);l.useEffect(function(){return function(){t.current()}},[])},xa=!!(typeof window<"u"&&window.document&&window.document.createElement);function Vr(e,t){if(xa){if(!e)return t;var r;return ba(e)?r=e():"current"in e?r=e.current:r=e,r}}var wa=function(e){var t=function(r,n,o){var a=l.useRef(!1),i=l.useRef([]),c=l.useRef([]),u=l.useRef(void 0);e(function(){var h,b=Array.isArray(o)?o:[o],d=b.map(function(p){return Vr(p)});if(!a.current){a.current=!0,i.current=d,c.current=n,u.current=r();return}(d.length!==i.current.length||!or(i.current,d)||!or(c.current,n))&&((h=u.current)===null||h===void 0||h.call(u),i.current=d,c.current=n,u.current=r())}),ga(function(){var h;(h=u.current)===null||h===void 0||h.call(u),a.current=!1})};return t},_a=wa(l.useEffect),Sa=function(e,t){t===void 0&&(t={});var r=Hr(t),n=l.useRef(void 0);_a(function(){var o=Vr(e);if(o!=null&&o.addEventListener){var a=function(d,p){var m=d.getData("text/uri-list"),_=d.getData("custom");if(_&&r.current.onDom){var x=_;try{x=JSON.parse(_)}catch{x=_}r.current.onDom(x,p);return}if(m&&r.current.onUri){r.current.onUri(m,p);return}if(d.files&&d.files.length&&r.current.onFiles){r.current.onFiles(Array.from(d.files),p);return}d.items&&d.items.length&&r.current.onText&&d.items[0].getAsString(function(f){r.current.onText(f,p)})},i=function(d){var p,m;d.preventDefault(),d.stopPropagation(),n.current=d.target,(m=(p=r.current).onDragEnter)===null||m===void 0||m.call(p,d)},c=function(d){var p,m;d.preventDefault(),(m=(p=r.current).onDragOver)===null||m===void 0||m.call(p,d)},u=function(d){var p,m;d.target===n.current&&((m=(p=r.current).onDragLeave)===null||m===void 0||m.call(p,d))},h=function(d){var p,m;d.preventDefault(),a(d.dataTransfer,d),(m=(p=r.current).onDrop)===null||m===void 0||m.call(p,d)},b=function(d){var p,m;a(d.clipboardData,d),(m=(p=r.current).onPaste)===null||m===void 0||m.call(p,d)};return o.addEventListener("dragenter",i),o.addEventListener("dragover",c),o.addEventListener("dragleave",u),o.addEventListener("drop",h),o.addEventListener("paste",b),function(){o.removeEventListener("dragenter",i),o.removeEventListener("dragover",c),o.removeEventListener("dragleave",u),o.removeEventListener("drop",h),o.removeEventListener("paste",b)}}},[],e)},qr=Symbol.for("immer-nothing"),ar=Symbol.for("immer-draftable"),ee=Symbol.for("immer-state");function ae(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var je=Object.getPrototypeOf;function Oe(e){return!!e&&!!e[ee]}function ge(e){var t;return e?Kr(e)||Array.isArray(e)||!!e[ar]||!!((t=e.constructor)!=null&&t[ar])||Qe(e)||Ze(e):!1}var Ra=Object.prototype.constructor.toString();function Kr(e){if(!e||typeof e!="object")return!1;const t=je(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Ra}function qe(e,t){Xe(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function Xe(e){const t=e[ee];return t?t.type_:Array.isArray(e)?1:Qe(e)?2:Ze(e)?3:0}function Ct(e,t){return Xe(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Gr(e,t,r){const n=Xe(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Ea(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Qe(e){return e instanceof Map}function Ze(e){return e instanceof Set}function be(e){return e.copy_||e.base_}function jt(e,t){if(Qe(e))return new Map(e);if(Ze(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Kr(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[ee];let o=Reflect.ownKeys(n);for(let a=0;a<o.length;a++){const i=o[a],c=n[i];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(n[i]={configurable:!0,writable:!0,enumerable:c.enumerable,value:e[i]})}return Object.create(je(e),n)}else{const n=je(e);if(n!==null&&r)return{...e};const o=Object.create(n);return Object.assign(o,e)}}function Tt(e,t=!1){return et(e)||Oe(e)||!ge(e)||(Xe(e)>1&&(e.set=e.add=e.clear=e.delete=Ca),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>Tt(n,!0))),e}function Ca(){ae(2)}function et(e){return Object.isFrozen(e)}var ja={};function xe(e){const t=ja[e];return t||ae(0,e),t}var Te;function Yr(){return Te}function Oa(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ir(e,t){t&&(xe("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Ot(e){zt(e),e.drafts_.forEach(za),e.drafts_=null}function zt(e){e===Te&&(Te=e.parent_)}function sr(e){return Te=Oa(Te,e)}function za(e){const t=e[ee];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function cr(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[ee].modified_&&(Ot(t),ae(4)),ge(e)&&(e=Ke(t,e),t.parent_||Ge(t,e)),t.patches_&&xe("Patches").generateReplacementPatches_(r[ee].base_,e,t.patches_,t.inversePatches_)):e=Ke(t,r,[]),Ot(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==qr?e:void 0}function Ke(e,t,r){if(et(t))return t;const n=t[ee];if(!n)return qe(t,(o,a)=>ur(e,n,t,o,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return Ge(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const o=n.copy_;let a=o,i=!1;n.type_===3&&(a=new Set(o),o.clear(),i=!0),qe(a,(c,u)=>ur(e,n,o,c,u,r,i)),Ge(e,o,!1),r&&e.patches_&&xe("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function ur(e,t,r,n,o,a,i){if(Oe(o)){const c=a&&t&&t.type_!==3&&!Ct(t.assigned_,n)?a.concat(n):void 0,u=Ke(e,o,c);if(Gr(r,n,u),Oe(u))e.canAutoFreeze_=!1;else return}else i&&r.add(o);if(ge(o)&&!et(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ke(e,o),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&Ge(e,o)}}function Ge(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Tt(t,r)}function Na(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Yr(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=n,a=Dt;r&&(o=[n],a=De);const{revoke:i,proxy:c}=Proxy.revocable(o,a);return n.draft_=c,n.revoke_=i,c}var Dt={get(e,t){if(t===ee)return e;const r=be(e);if(!Ct(r,t))return Pa(e,r,t);const n=r[t];return e.finalized_||!ge(n)?n:n===mt(e.base_,t)?(vt(e),e.copy_[t]=Pt(n,e)):n},has(e,t){return t in be(e)},ownKeys(e){return Reflect.ownKeys(be(e))},set(e,t,r){const n=Jr(be(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const o=mt(be(e),t),a=o==null?void 0:o[ee];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Ea(r,o)&&(r!==void 0||Ct(e.base_,t)))return!0;vt(e),Nt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return mt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,vt(e),Nt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=be(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){ae(11)},getPrototypeOf(e){return je(e.base_)},setPrototypeOf(){ae(12)}},De={};qe(Dt,(e,t)=>{De[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});De.deleteProperty=function(e,t){return De.set.call(this,e,t,void 0)};De.set=function(e,t,r){return Dt.set.call(this,e[0],t,r,e[0])};function mt(e,t){const r=e[ee];return(r?be(r):e)[t]}function Pa(e,t,r){var o;const n=Jr(t,r);return n?"value"in n?n.value:(o=n.get)==null?void 0:o.call(e.draft_):void 0}function Jr(e,t){if(!(t in e))return;let r=je(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=je(r)}}function Nt(e){e.modified_||(e.modified_=!0,e.parent_&&Nt(e.parent_))}function vt(e){e.copy_||(e.copy_=jt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var ka=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const i=this;return function(u=a,...h){return i.produce(u,b=>r.call(this,b,...h))}}typeof r!="function"&&ae(6),n!==void 0&&typeof n!="function"&&ae(7);let o;if(ge(t)){const a=sr(this),i=Pt(t,void 0);let c=!0;try{o=r(i),c=!1}finally{c?Ot(a):zt(a)}return ir(a,n),cr(o,a)}else if(!t||typeof t!="object"){if(o=r(t),o===void 0&&(o=t),o===qr&&(o=void 0),this.autoFreeze_&&Tt(o,!0),n){const a=[],i=[];xe("Patches").generateReplacementPatches_(t,o,a,i),n(a,i)}return o}else ae(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(i,...c)=>this.produceWithPatches(i,u=>t(u,...c));let n,o;return[this.produce(t,r,(i,c)=>{n=i,o=c}),n,o]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ge(e)||ae(8),Oe(e)&&(e=Aa(e));const t=sr(this),r=Pt(e,void 0);return r[ee].isManual_=!0,zt(t),r}finishDraft(e,t){const r=e&&e[ee];(!r||!r.isManual_)&&ae(9);const{scope_:n}=r;return ir(n,t),cr(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));const n=xe("Patches").applyPatches_;return Oe(e)?n(e,t):this.produce(e,o=>n(o,t))}};function Pt(e,t){const r=Qe(e)?xe("MapSet").proxyMap_(e,t):Ze(e)?xe("MapSet").proxySet_(e,t):Na(e,t);return(t?t.scope_:Yr()).drafts_.push(r),r}function Aa(e){return Oe(e)||ae(10,e),Xr(e)}function Xr(e){if(!ge(e)||et(e))return e;const t=e[ee];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=jt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=jt(e,!0);return qe(r,(n,o)=>{Gr(r,n,Xr(o))}),t&&(t.finalized_=!1),r}var te=new ka,Ma=te.produce;te.produceWithPatches.bind(te);te.setAutoFreeze.bind(te);te.setUseStrictShallowCopy.bind(te);te.applyPatches.bind(te);te.createDraft.bind(te);te.finishDraft.bind(te);const Xa=({pending:e,className:t,messages:r,sessionId:n,onSendMessages:o,onCancelChat:a})=>{const{t:i}=vr(),{textModel:c,selectedTools:u}=mr(),[h,b]=l.useState(""),[d,p]=l.useState(!1),[m,_]=l.useState("auto"),[x,f]=l.useState(1),[E,S]=l.useState(!1),A=30,I=l.useRef(null),N=l.useRef(null),j=l.useRef(null),[R,U]=l.useState([]),L=l.useCallback(()=>s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("span",{className:"text-sm text-muted-foreground flex-1",children:i("chat:insufficientBalanceDescription")}),s.jsx(fe,{size:"sm",variant:"outline",className:"shrink-0",onClick:()=>{var C;const v=`${En}/billing`;(C=window.electronAPI)!=null&&C.openBrowserUrl?window.electronAPI.openBrowserUrl(v):window.open(v,"_blank")},children:i("common:auth.recharge")})]}),[i]),{mutate:O}=Bn({mutationFn:v=>qn(v),onSuccess:v=>{U(C=>[...C,{file_id:v.file_id,width:v.width,height:v.height}])},onError:v=>{Me.error("Failed to upload image",{description:s.jsx("div",{children:v.toString()})})}}),B=l.useCallback(v=>{const C=v.target.files;if(C)for(const T of C)O(T)},[O]),y=l.useCallback(async()=>{n&&await Promise.all([Un(n),Wn(n)]),a==null||a()},[n,a]),g=l.useCallback(async()=>{if(e)return;if(!c){Me.error(i("chat:textarea.selectModel"));return}(!u||u.length===0)&&Me.warning(i("chat:textarea.selectTool"));let v=h;if(h.length===0||h.trim()===""){Me.error(i("chat:textarea.enterPrompt"));return}let C="";m!=="auto"&&(C+=`<aspect_ratio>${m}</aspect_ratio>
`),x!==1&&(C+=`<quantity>${x}</quantity>
`),C&&(v=v+`

`+C);const T=[{type:"text",text:v},...R.map(k=>(console.log("处理图片对象:",k),{type:"image_url",image_url:{url:`/api/file/${k.file_id}`}}))],G=r.concat([{role:"user",content:T}]);U([]),b(""),o(G,{textModel:c,toolList:u&&u.length>0?u:[]})},[e,c,u,h,o,R,r,i,m,x,L]),w=l.useRef(null),[W,M]=l.useState(!1),J=l.useCallback(v=>{for(const C of v)O(C)},[O]);return Sa(w,{onDragOver(){M(!0)},onDragLeave(){M(!1)},onDrop(){M(!1)},onFiles:J}),l.useEffect(()=>{const v=T=>{var G;T.forEach(async k=>{if(k.base64){const $=dr(k.base64,k.fileId);O($)}else console.log("处理Canvas图片对象:",k),U(Ma($=>{$.push({file_id:k.url||k.fileId,width:k.width,height:k.height})}))}),(G=I.current)==null||G.focus()},C=async T=>{var G;T.forEach(async k=>{console.log("处理素材图片对象:",k);try{const $=`/api/serve_file?file_path=${encodeURIComponent(k.filePath)}`,ue=await(await fetch($)).blob(),ne=new File([ue],k.fileName,{type:`image/${k.fileType}`});O(ne)}catch($){console.error("Failed to load image from material:",$),Me.error("Failed to load image from material",{description:`${$}`})}}),(G=I.current)==null||G.focus()};return Be.on("Canvas::AddImagesToChat",v),Be.on("Material::AddImagesToChat",C),()=>{Be.off("Canvas::AddImagesToChat",v),Be.off("Material::AddImagesToChat",C)}},[O]),l.useEffect(()=>{const v=C=>{N.current&&!N.current.contains(C.target)&&S(!1)};return E&&document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[E]),s.jsxs(Ie.div,{ref:w,className:pr("w-full flex flex-col items-center border border-primary/20 rounded-2xl p-3 hover:border-primary/40 transition-all duration-300 cursor-text gap-5 bg-background/80 backdrop-blur-xl relative",d&&"border-primary/40",t),style:{boxShadow:d?"0 0 0 4px color-mix(in oklab, var(--primary) 10%, transparent)":"none"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"linear"},onClick:()=>{var v;return(v=I.current)==null?void 0:v.focus()},children:[s.jsx(at,{children:W&&s.jsx(Ie.div,{className:"absolute top-0 left-0 right-0 bottom-0 bg-background/50 backdrop-blur-xl rounded-2xl z-10",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-sm text-muted-foreground",children:"Drop images here to upload"})})})}),s.jsx(at,{children:R.length>0&&s.jsx(Ie.div,{className:"flex items-center gap-2 w-full",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeInOut"},children:R.map(v=>s.jsxs(Ie.div,{className:"relative size-10",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,ease:"easeInOut"},children:[s.jsx("img",{src:`/api/file/${v.file_id}`,alt:"Uploaded image",className:"w-full h-full object-cover rounded-md",draggable:!1}),s.jsx(fe,{variant:"secondary",size:"icon",className:"absolute -top-1 -right-1 size-4",onClick:()=>U(C=>C.filter(T=>T.file_id!==v.file_id)),children:s.jsx(Cn,{className:"size-3"})})]},v.file_id))})}),s.jsx(fa,{ref:I,className:"w-full h-full border-none outline-none resize-none",placeholder:i("chat:textarea.placeholder"),value:h,autoSize:!0,onChange:v=>b(v.target.value),onFocus:()=>p(!0),onBlur:()=>p(!1),onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),g())}}),s.jsxs("div",{className:"flex items-center justify-between gap-2 w-full",children:[s.jsxs("div",{className:"flex items-center gap-2 max-w-[calc(100%-50px)] flex-wrap",children:[s.jsx("input",{ref:j,type:"file",accept:"image/*",multiple:!0,onChange:B,hidden:!0}),s.jsx(fe,{variant:"outline",size:"sm",onClick:()=>{var v;return(v=j.current)==null?void 0:v.click()},children:s.jsx(jn,{className:"size-4"})}),s.jsx(ya,{}),s.jsxs(yr,{children:[s.jsx(br,{asChild:!0,children:s.jsxs(fe,{variant:"outline",className:"flex items-center gap-1",size:"sm",children:[s.jsx(Wt,{className:"size-4"}),s.jsx("span",{className:"text-sm",children:m}),s.jsx(yt,{className:"size-3 opacity-50"})]})}),s.jsx(gr,{align:"start",className:"w-32",children:["auto","1:1","4:3","3:4","16:9","9:16"].map(v=>({ratio:v,icon:v==="auto"?s.jsx(Wt,{className:"size-4"}):v==="1:1"?s.jsx(Ht,{className:"size-4"}):["4:3","16:9"].includes(v)?s.jsx("div",{className:"w-6 h-4 border border-border rounded-sm"}):s.jsx("div",{className:"w-4 h-6 border border-border rounded-sm"})})).map(({ratio:v,icon:C})=>s.jsxs(Pn,{onClick:()=>_(v),className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[C,s.jsx("span",{children:v})]}),m===v&&s.jsx("div",{className:"size-2 rounded-full bg-primary"})]},v))})]}),s.jsxs("div",{className:"relative",ref:N,children:[s.jsxs(fe,{variant:"outline",className:"flex items-center gap-1",onClick:()=>S(!E),size:"sm",children:[s.jsx(In,{className:"size-4"}),s.jsx("span",{className:"text-sm",children:x}),s.jsx(yt,{className:"size-3 opacity-50"})]}),s.jsx(at,{children:E&&s.jsxs(Ie.div,{className:"absolute bottom-full mb-2 left-0  bg-background border border-border rounded-lg p-4 shadow-lg min-w-48",initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.15,ease:"easeOut"},children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:i("chat:textarea.quantity","Image Quantity")}),s.jsx("span",{className:"text-sm text-muted-foreground",children:x})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"1"}),s.jsx("input",{type:"range",min:"1",max:A,value:x,onChange:v=>f(Number(v.target.value)),className:`flex-1 h-2 bg-muted rounded-lg appearance-none cursor-pointer\r
                                  [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4\r
                                  [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-primary\r
                                  [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-sm\r
                                  [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 [&::-moz-range-thumb]:rounded-full\r
                                  [&::-moz-range-thumb]:bg-primary [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0`}),s.jsx("span",{className:"text-xs text-muted-foreground",children:A})]})]}),s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-border"}),s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-background translate-y-[-1px]"})]})})]})]}),e?s.jsxs(fe,{className:"shrink-0 relative",variant:"default",size:"icon",onClick:y,children:[s.jsx(Dn,{className:"size-5.5 animate-spin absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"}),s.jsx(Ht,{className:"size-2 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})]}):s.jsx(fe,{className:"shrink-0",variant:"default",size:"icon",onClick:g,disabled:!c||!u||h.length===0,children:s.jsx(An,{className:"size-4"})})]})]})},Ia="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Qa=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Ia[r[e]&63];return t};export{Xa as C,Dn as L,Ht as S,Ee as _,_a as a,Hr as b,Ba as c,Va as d,Ya as e,Ja as f,Vr as g,Ka as h,ba as i,va as j,qa as k,La as l,Ua as m,Qa as n,Ma as p,Ha as r,Wa as s,Bn as u};
